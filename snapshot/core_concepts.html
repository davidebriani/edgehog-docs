<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.25.5">
    <meta name="project" content="Edgehog v0.5.0">

    <title>Core concepts — Edgehog v0.5.0</title>
    <link rel="stylesheet" href="dist/elixir-d1506dba1db7cdc5483e.css" />

    <script src="dist/sidebar_items-129a6b6347.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-7b632b26f13d5e0d20e1.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        if (localStorage.getItem('night-mode') === 'true') {
          document.body.classList.add('night-mode');
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <span class="icon-search" aria-hidden="true" title="Submit search"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <span class="icon-cross" aria-hidden="true" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="http://edgehog.io" class="sidebar-projectName">
Edgehog
      </a>
      <strong class="sidebar-projectVersion">
        v0.5.0
      </strong>
    </div>

      <a href="http://edgehog.io">
        <img src="assets/logo.png" alt="Edgehog" class="sidebar-projectImage">
      </a>

  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list-link" href="#full-list">Pages</a></li>


  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1 id="content">
Core concepts

</h1>

<p>This page will illustrate some of the core concepts used in Edgehog.</p><h2 id="hardware-types-devices-and-system-models" class="section-heading">
  <a href="#hardware-types-devices-and-system-models" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Hardware types, Devices and System Models
</h2>
<p>This section will deal with the difference between three main concepts used throughout Edgehog:
Hardware Types, Devices and System Models.</p><p>To better illustrate this, we will use as example the ACME Inc company, which manages a fleet of
e-bikes and electric scooters. We will illustrate the hierarchy going from the bottom up, showing
how each concept relates to the other ones.</p><h3 id="hardware-type" class="section-heading">
  <a href="#hardware-type" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Hardware Type
</h3>
<p>An Hardware Type represents the electronic hardware components embedded in an device. As an example,
a possible Hardware Type description could be &quot;ESP32 with a GSM module&quot; or &quot;RaspberryPi 0 with an
LTE modem&quot;.</p><p>Each Hardware Type can have one or more Hardware Type Part Numbers associated with it. This makes
sure that the user is able to map, e.g., a new revision of the PCB to the same Hardware Type, since
different hardware with the same Hardware Type is assumed to be compatible. Usually (but not
necessarily) the Hardware Type Part Number is a code that is written on the PCB.</p><h3 id="device" class="section-heading">
  <a href="#device" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Device
</h3>
<p>A device is an entity connected to Astarte. A Device has a uniquely identified by its Device ID, and
it usually lives inside a product such as an e-bike (if it is not on a shelf or in a repair shop).</p><h3 id="system-models" class="section-heading">
  <a href="#system-models" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  System Models
</h3>
<p>A System Model constitutes a group of devices implementing the same functionality for some users.
For example, two e-bikes can be physically identical and still belong to different System Models,
since they can have different software running on them.</p><p>A System Model is associated with a specific Hardware Type, so two devices implementing the same
functionality but using different Hardware Types will belong to two different System Models. This
makes it so that the System Model is the fundamental identifier when it comes to software updates.</p><p>A System Model has one or more System Model Part Numbers asociated with it, allowing to track newer
versions of a product which do not change its main functionality. Usually (but not necessarily) the
System Model's Part Number is delivered along with the device, or on the box containing it.</p><p>Drawing again from our bike sharing example, e-bikes and electric scooters would have two different
System Models, even if they use the same Hardware Type (e.g. an ESP32 with a GSM module). It is also
possible that the e-bikes are further split into different System Models depending on the country
they are deployed in if, for example, the software has to conform to speed limitations which are
specific for each country.</p><h2 id="tags-attributes-and-groups" class="section-heading">
  <a href="#tags-attributes-and-groups" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Tags, attributes and groups
</h2>
<p>This section will deal with various types of properties that can be added to devices to identify
and group them.</p><h3 id="tags" class="section-heading">
  <a href="#tags" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Tags
</h3>
<p>Tags are string values that can be freely attached to Devices. There is no predefined semantics so
users are free to use them as they see fit.</p><p>Some examples of tags that can be assigned to the e-bikes or electric scooters in our examples
could be <code class="inline">out-of-order</code>, <code class="inline">test_machine</code> or <code class="inline">Upgraded Brakes</code>.</p><h3 id="attributes" class="section-heading">
  <a href="#attributes" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Attributes
</h3>
<p>Attributes are namespaced key-value pairs that can be attached to Devices. The namespacing happens
by prepending the namespace to the key using a colon as separator (i.e. <code class="inline">namespace:key</code>). This
ensures that the same key in different namespaces can be addressed unambiguously.</p><p>The attribute keys are always strings, while values support all the types <a href="https://docs.astarte-platform.org/latest/030-interface.html#supported-data-types">supported by Astarte
Interfaces</a>.</p><p>The majority of attributes are automatically populated using different mechanisms depending on the
namespaces, but there's also the possibility of manually defining custom attributes for a specific
device.</p><p>The supported namespaces are:</p><ul><li><code class="inline">edgehog-synthetic</code>: automatically populated with values coming from Device data that is derived
from Edgehog (e.g. Geolocation, System Model, Hardware Type, etc...)</li><li><code class="inline">edgehog-policy</code>: automatically populated with Edgehog values which are imposed on the cloud side
(e.g. Geolocation disabled due to GDPR restrictions).</li><li><code class="inline">astarte-values</code>: automatically populated with values coming from device-owned Astarte interfaces
using an <a href="#attribute-value-source">Attribute Value Source</a> with type <code class="inline">astarte-value</code>.</li><li><code class="inline">astarte-attributes</code>: automatically populated using the <code class="inline">attributes</code> map in the Device status
returned from Astarte AppEngine API. Since Astarte attributes don't provide a trigger mechanism,
these attributes are lazily populated and should be considered eventually consistent.</li><li><code class="inline">custom</code>: user-defined key-value pairs which are manually assigned to a Device.</li></ul><p>Note that all values will be converted to a string when using them as attribute values</p><h3 id="attribute-value-source" class="section-heading">
  <a href="#attribute-value-source" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Attribute Value Source
</h3>
<p>An Attribute Value Source populates the attributes of a Device according to some rule.</p><p>Currently, the only supported type of Attribute Value Source is <code class="inline">astarte-value</code>, which updates
Device attributes using a value from an Astarte interface.</p><h3 id="selector" class="section-heading">
  <a href="#selector" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Selector
</h3>
<p>A Selector allows selecting a subset of Devices based on their tags and attributes. The Selector
can be evaluated for a Device and return <code class="inline">true</code> if the Device matches the Selector and <code class="inline">false</code>
otherwise.</p><p>Each Selector can be made of one or more filters, combined using <code class="inline">and</code> and <code class="inline">or</code> and (possibly)
parenthesized. When no parenthesis are present, <code class="inline">and</code> has a higher priority than <code class="inline">or</code> in
expressions.</p><h4>Supported filters</h4><h5>Tag filter</h5><p>Created with the syntax <code class="inline">&quot;&lt;value&gt;&quot; in tags</code>, it returns <code class="inline">true</code> if <code class="inline">value</code> is included in the Device
tags. It's also possible to use a negative filter with <code class="inline">&quot;value&quot; not in tags</code>, in this case the
filter will match all Devices which <em>don't</em> have the tag.</p><h5>Attribute filter</h5><p>Created with the syntax <code class="inline">attributes[&quot;&lt;namespace&gt;:&lt;key&gt;&quot;] &lt;operator&gt; &lt;value&gt;</code>, it returns <code class="inline">true</code> if
the value of the chosen attribute satisfies the expression.</p><p>The supported operators are:</p><ul><li><code class="inline">==</code> and <code class="inline">!=</code> for all value types</li><li><code class="inline">&gt;</code>, <code class="inline">&gt;=</code>, <code class="inline">&lt;</code>, <code class="inline">&lt;=</code> for numeric or <code class="inline">datetime</code> values</li></ul><p><code class="inline">&lt;value&gt;</code> can be a boolean (<code class="inline">true</code> or <code class="inline">false</code>), a string, a number (either integer or float), or one
of the values supported using special syntax:</p><ul><li><code class="inline">now()</code> indicates the current datetime at the time the Selector is evaluated. This can be used to
do comparisons with other <code class="inline">datetime</code> attributes.</li><li><code class="inline">datetime(&quot;&lt;ISO8601 string&gt;&quot;)</code> is used to pass <code class="inline">datetime</code> values in expressions. The string
contained in double quotes must be a valid UTC ISO8601 timestamp. Example:
<code class="inline">datetime(&quot;2022-06-27T16:27:40.254795Z&quot;)</code>.</li><li><code class="inline">binaryblob(&quot;&lt;base64 encoded value&gt;&quot;)</code> is used to pass <code class="inline">binaryblob</code> values in expressions. The
string contained in double quotes must be a valid Base64 encoding of the binary value. Example:
<code class="inline">binaryblob(&quot;Zm9vYmFy&quot;)</code> to encode the string <code class="inline">&quot;foobar&quot;</code>.</li></ul><h5>Attribute inclusion filter (Not supported yet)</h5><ul><li><code class="inline">&quot;&lt;value&gt;&quot; in attributes[&quot;&lt;namespace&gt;:&lt;key&gt;&quot;]</code>: returns <code class="inline">true</code> if <code class="inline">value</code> is included in the
chosen attribute. Note that the attribute must be an array for the expression to be valid.</li></ul><h4>Examples</h4><p>To provide some examples, here is a Selector to target all out of order Devices in Milan:</p><pre><code class="makeup elixir"><span class="s">&quot;out-of-order&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">tags</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">attributes</span><span class="p" data-group-id="9550984199-1">[</span><span class="s">&quot;edgehog-synthetic:city&quot;</span><span class="p" data-group-id="9550984199-1">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Milan&quot;</span></code></pre><p>Here is a selector to target all Devices that have their service timestamp in the past so they have
to be serviced, imagining this information is contained in the <code class="inline">com.foo.ServiceInfo</code> Astarte
interface in the <code class="inline">/nextServiceTimestamp</code>:</p><pre><code class="makeup elixir"><span class="n">attributes</span><span class="p" data-group-id="2199397456-1">[</span><span class="s">&quot;astarte-values:com.foo.ServiceInfo/serviceTimestamp&quot;</span><span class="p" data-group-id="2199397456-1">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">now</span><span class="p" data-group-id="2199397456-2">(</span><span class="p" data-group-id="2199397456-2">)</span></code></pre><h4>Caveats</h4><p>Note that numeric values are conflated in a single numeric type, i.e. a selector with
<code class="inline">attributes[&quot;custom:foo&quot;] == 42</code> will match either if <code class="inline">foo</code> is <code class="inline">integer</code>, <code class="inline">longinteger</code> or <code class="inline">double</code>
(e.g it will also match <code class="inline">42.0</code>).</p><p>Another important thing to notice is that using an Attribute Filter will implicitly match only
Devices that have that attribute. As an example, if there are 3 devices, one with attribute <code class="inline">foo:bar == 42</code>, the other with attribute <code class="inline">foo:bar == 3</code> and the third one with no <code class="inline">foo:bar</code> attribute, the
Attribute Filter <code class="inline">attributes[&quot;foo:bar&quot;] != 42</code> will match the second Device but <em>not</em> the third one,
since it doesn't have the target attribute.</p><p>In the future, additional syntax could be added to Selectors to allow filtering based just on the
presence or absence of an attribute.</p><h3 id="group" class="section-heading">
  <a href="#group" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Group
</h3>
<p>A Group represents a subset of devices filtered by a Selector.</p><p>The Group can be used to perform operations on Devices contained in it (e.g. an <a href="#update-campaign">Update
Campaign</a>).</p><p>Since Tags and Attributes of a Device can change, Groups do not statically define the set of Devices
they contain but they change dynamically following Device changes.</p><p>Note that a Device can't be manually assigned to a Group, its tags and attributes must be
used to make it satisfy the group Selector.</p><h2 id="ota-update-concepts" class="section-heading">
  <a href="#ota-update-concepts" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  OTA Update Concepts
</h2>
<p>This section will deal with the concepts used by Edgehog's OTA update mechanism, and it covers
various aspects of the software running on Devices. The <a href="ota_updates.html">OTA Updates</a> page adds
operative details to the concepts presented here.</p><h3 id="base-image" class="section-heading">
  <a href="#base-image" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Base Image
</h3>
<p>A Base Image is an image created to be run on a Device. The exact content of the Base Image can vary
depending on the use case, but it usually contains the operating system image or the device
firmware. Each Base Image belongs to a <a href="#base-image-collection">Base Image Collection</a>.</p><p>Base Images follow semantic versioning, so that the user is able to know when a specific update can
contain breaking changes. Each Base Image must have a unique version number.</p><h2 id="base-image-collection" class="section-heading">
  <a href="#base-image-collection" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Base Image Collection
</h2>
<p>A Base Image Collection is a set of Base Images associated with a specific <a href="#system-models">System
Model</a> and, implicitly via the System Model, with a specific <a href="#hardware-types">Hardware
Type</a>. The mapping relation between Base Image Collection and System Models is 1:1,
so a Base Image Collection is associated with a single System Model and viceversa.</p><p>A Base Image Collection contains all the Base Images that ran, are running or could be run on a
System Model. Drawing from the bike sharing example, there would be a different Base Image
Collection for, e.g., e-bikes from each specific country to handle the different speed limitations.</p><p>Basically the job of a Base Image Collection is to limit what can be installed to a System Model, to
avoid accidentally installing the firmware for an electric scooter on an e-bike.</p><h2 id="update-channels" class="section-heading">
  <a href="#update-channels" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Update Channels
</h2>
<p>An Update Channel represents the subscription of a Device to a specific set of Base Images.</p><p>Each Device is always associated with an Update Channel (e.g. <code class="inline">default</code>, <code class="inline">stable</code>, <code class="inline">beta</code>, <code class="inline">devel</code>,
...). To assign a Device to a specific Update Channel (other than the default one) the device must
belong to a <a href="#group">Group</a> and that Group has to be assigned to the Target Groups of the Update
Channel.</p><p>The same Base Image can be associated with multiple Update Channels. This guarantees
that once testers in the <code class="inline">beta</code> Update Channel validate the Base Image, the exact same Base Image
will be used to update devices in the <code class="inline">default</code> Update Channel.</p><p>It's possible to automatically assign an Update Channel to one or more <a href="#group">Groups</a>.</p><h2 id="update-campaign" class="section-heading">
  <a href="#update-campaign" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Update Campaign
</h2>
<p>An Update Campaign is the operation that tracks the distribution of a specific Base Image to all
devices belonging to an Update Channel.</p><p>Each Update Channel can have only one live campaign at a time for a specific System Model, so
creating a new campaign implicitly replaces the old one if it was still active.</p><p>An Update Campaign can define additional constraints about which devices can be updated (e.g.
minimum current version, allow downgrade, etc).</p><h2 id="rollout-mechanism" class="section-heading">
  <a href="#rollout-mechanism" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Rollout Mechanism
</h2>
<p>The Rollout Mechanism determines the details of how an Update Campaign is carried out.</p><p>It is responsible of deciding if the update is pushed towards the devices or pulled by users
interacting with them.</p><p>It also defines other details like how many devices are updated at a time, how many errors should be
supported before aborting the campaign etc.</p><p>There are currently two main Mechanisms available: Push and Optional. The Push mechanism pushes the
update towards the device unconditionally, while the Optional mechanism waits for a confirmation on
the Device side (usually given by a user) before starting to download the update.</p><h2 id="ota-operation" class="section-heading">
  <a href="#ota-operation" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  OTA Operation
</h2>
<p>An OTA Operation tracks the progress of an update to a specific Device. It is started when Edgehog
starts pushing the update to the Device and ends either with a success or with an error (possibly
due to a timeout).</p><h2 id="maintenance-window" class="section-heading">
  <a href="#maintenance-window" class="hover-link"><span class="icon-link" aria-hidden="true"></span></a>
  Maintenance Window
</h2>
<p>Each Device can have an optional Maintenance Window. This is used by Update Campaign to determine
which Devices can be updated at a specific time.</p><p>If a Device declares a Maintenance Window, the updates targeting it will start only in the interval
defined by it. Note that there's no guarantee that the update will also terminate inside the
Maintenance Window.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="intro_user.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Introduction
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="hardware_types.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Hardware Types
        </span>
      </a>

  </div>
</div>

      <footer class="footer">

        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.25.5) for the
            <a href="https://elixir-lang.org" title="Elixir" target="_blank">Elixir programming language</a>.
          </span>
          <span class="line">
            Designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>

          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
